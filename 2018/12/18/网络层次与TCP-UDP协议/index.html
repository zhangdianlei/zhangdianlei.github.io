<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>网络层次与TCP/UDP协议 | 雷音不响，春帷不揭</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">网络层次与TCP/UDP协议</h1><a id="logo" href="/.">雷音不响，春帷不揭</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">网络层次与TCP/UDP协议</h1><div class="post-meta">Dec 18, 2018</div><div class="post-content"><h2 id="OSI-Open-System-Interconnect-七层模型"><a href="#OSI-Open-System-Interconnect-七层模型" class="headerlink" title="OSI(Open System Interconnect)七层模型"></a>OSI(Open System Interconnect)七层模型</h2><table>
<thead>
<tr>
<th>OSI中的层</th>
<th>功能</th>
<th>TCP/IP协议</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层</td>
<td>文件传输，电子邮件，文件服务，虚拟终端</td>
<td>HTTP, FTP, SFTP, DNS, Telnet, TFTP, SNMP</td>
</tr>
<tr>
<td>表示层</td>
<td>数据格式化，代码转换，数据加密</td>
<td>没有</td>
</tr>
<tr>
<td>会话层</td>
<td>解除或建立与其他节点的联系</td>
<td>没有</td>
</tr>
<tr>
<td>传输层</td>
<td>提供端对端的接口</td>
<td>TCP, UDP</td>
</tr>
<tr>
<td>网络层</td>
<td>为数据包选择路由</td>
<td>IP, ICMP, RIP, OSPF, BGP, IGMP</td>
</tr>
<tr>
<td>数据链路层</td>
<td>传输有地址的帧，错误检测功能</td>
<td>SLIP, CSLIP, PPP, ARP, RARP, MTU</td>
</tr>
<tr>
<td>物理层</td>
<td>以二进制数据形式在物理媒体上传输数据</td>
<td>ISO2110, IEEE802, IEEE802.2</td>
</tr>
</tbody>
</table>
<h2 id="TCP-IP五层模型的协议"><a href="#TCP-IP五层模型的协议" class="headerlink" title="TCP/IP五层模型的协议"></a>TCP/IP五层模型的协议</h2><table>
<thead>
<tr>
<th style="text-align:center">TCP/IP层</th>
<th>网络设备</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">应用层</td>
<td></td>
</tr>
<tr>
<td style="text-align:center">传输层</td>
<td>四层交换机、也有工作在四层的路由器</td>
</tr>
<tr>
<td style="text-align:center">网络层</td>
<td>路由器、三层交换机</td>
</tr>
<tr>
<td style="text-align:center">数据链路层</td>
<td>网桥（现已很少使用）、以太网交换机（二层交换机）、网卡（其实网卡是一半工作在物理层、一半工作在数据链路层）</td>
</tr>
<tr>
<td style="text-align:center">物理层</td>
<td>中继器、集线器、还有我们通常说的双绞线也工作在物理层</td>
</tr>
</tbody>
</table>
<h2 id="TCP-UDP协议"><a href="#TCP-UDP协议" class="headerlink" title="TCP/UDP协议"></a>TCP/UDP协议</h2><p><strong>TCP</strong>(Transmission Control Protocol)和<strong>UDP</strong>(User Datagram Protocol)协议属于传输层协议。</p>
<ul>
<li>TCP提供IP环境下的数据可靠传输，它提供的服务包括数据流传送、可靠性、有效流控、全双工操作和多路复用。通过面向连接、端到端和可靠的数据包发送。通俗说，它是事先为所发送的数据开辟出连接好的通道，然后再进行数据发送。</li>
<li>UDP则不为IP提供可靠性、流控或差错恢复功能。一般来说，TCP对应的是可靠性要求高的应用，而UDP对应的则是可靠性要求低、传输经济的应用。</li>
</ul>
<h4 id="简述比较："><a href="#简述比较：" class="headerlink" title="简述比较："></a><strong>简述比较：</strong></h4><p>UDP在传送数据之前不需要先建立连接。远地主机的运输层在收到UDP报文后，不需要给出任何确认，虽然UDP不提供可靠交付，但在某些情况下UDP确实一种最有效的工作方式。</p>
<p>TCP则是提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。由于TCP要提供可靠的、面向连接的运输服务，因此不可避免地增加了许多开销，如确认、流量控制、计时器以及连接管理等。这不仅使协议数据单元的首部增大很多，还要占用许多的处理器资源。</p>
<p>TCP支持的应用协议主要有：Telnet、FTP、SMTP等；</p>
<p>UDP支持的应用层协议主要有：NFS（网络文件系统）、SNMP（简单网络管理协议）、DNS（主域名称系统）、TFTP（通用文件传输协议）等。</p>
<p>TCP/IP协议与低层的数据链路层和物理层无关，这也是TCP/IP的重要特点。</p>
<h3 id="用户数据报协议UDP"><a href="#用户数据报协议UDP" class="headerlink" title="用户数据报协议UDP"></a>用户数据报协议UDP</h3><h4 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h4><ul>
<li><p><strong>UDP是无连接的</strong>，即发送数据之间不需要建立连接，因此减少了开销和发送数据之前的时延。</p>
</li>
<li><p>UDO使用<strong>尽最大努力交付</strong>，即不保证可靠交付，因此主机不需要维持复杂的连接状态。</p>
</li>
<li><p>UDP是<strong>面向报文</strong>。发送方的UDP对应用程序交下来的报文在添加首部后就向下交付给IP层，对交下来的报文既不合并也不拆分。因此，应用进程必须选择合适大小的报文，若报文太长，UDP把它交付给IP层后，IP层在传送时可能要进行分片，这会降低IP层的效率；反之，若报文太短，UDO把它交给IP层后，会使IP数据报的首部的相对长度太大，也降低了IP层的效率。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fyatzvicdhj30cn05lgmm.jpg" width="400px/"></p>
</li>
<li><p>UDP没有拥塞控制，保证了应用的实时性。</p>
</li>
<li><p>支持一对一、一对多、多对一和多对多的交互通信。</p>
</li>
<li><p>UDP的首部开销小，只有8个字节，比TCP的20个字节的首部要短</p>
</li>
</ul>
<h4 id="UDP首部的格式"><a href="#UDP首部的格式" class="headerlink" title="UDP首部的格式"></a>UDP首部的格式</h4><p>UDP有数据字段和首部字段两个字段。首部字段只有8个字节，分别为源端口、目的端口、长度和检验和。检验和用于检测UDP用户数据报在传输中是否有错，有错就丢弃。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fyatzvdnc6j30cy07n404.jpg" width="400px"></p>
<p>当运输层从IP层收到UDP数据报时，就根据首部中的目的端口，把UDP数据报通过相应的端口上交给进程。如果接方UDP发现收到的报文中的目的端口不正确就丢弃报文，并由ICMP发送“端口不可达”差错报文交给发送方。</p>
<p>在计算检验和时，要在UDP用户数据报之前增加12个字节的伪首部。“伪首部”并不是用户数据报真正的首部，只是在计算检验和时，临时添加在UDP数据报前面，得到一个临时UDP数据报。伪首部既不向下传送也不向上递交，仅仅是为了计算检验和。</p>
<h4 id="UDP典型应用"><a href="#UDP典型应用" class="headerlink" title="UDP典型应用"></a>UDP典型应用</h4><ul>
<li>UDP适合于这样的进程：需要简单的请求-响应通信，而较少考虑流量控制和差错控制。对于需要传送成块数据的进程（如FTP）则不适合使用UDP。</li>
<li>UDP适合于具有内部流量控制和差错控制机制的进程，如简单文件传输协议TFTP。</li>
<li>对多播来说，UDP是一个合适的传输协议。</li>
<li>UDP常用于交互实时应用，以避免接收报文之间的不一致延时。</li>
<li>UDP可用于管理进程，如SNMP。</li>
</ul>
<h3 id="传输控制协议TCP"><a href="#传输控制协议TCP" class="headerlink" title="传输控制协议TCP"></a>传输控制协议TCP</h3><h4 id="主要特点-1"><a href="#主要特点-1" class="headerlink" title="主要特点"></a>主要特点</h4><ul>
<li><p>TCP是<strong>面向连接的运输层协议</strong>。应用程序在使用TCP协议之前，必须先简历TCP连接。在传送数据完毕后，必须释放已经简历的TCP连接。</p>
</li>
<li><p>每一条TCP连接只能有<strong>两个端点</strong>，只能是点对点的。</p>
</li>
<li><p>TCP提供<strong>可靠交付</strong>的服务。TCP连接传送的数据保证无差错、不丢失、不重复、并按序到达。</p>
</li>
<li><p>TCP提供<strong>全双工通信</strong>。TCP允许通信双方的应用进程在任何时候都能发送数据。TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据。</p>
</li>
<li><p><strong>面向字节流</strong>。虽然应用程序和TCP的交互是一次一个数据块，但TCP把应用程序交下来的数据看成是一连串的务结构的字节流。TCP不保证接收方应用程序所收到的数据块和发送方应用程序所发出的数据块具有对应大小的关系（例如，发送方应用程序交给发送方TCP共有10个数据块，但接收方TCP可能只用了4个数据块就把收到的字节流交付给了上层应用程序）。但接收方应用程序收到的字节流必须和发送方应用程序发出的字节流完全一样。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fyatzvsb72j30hr09cq5f.jpg" width="500px/"></p>
</li>
</ul>
<h4 id="TCP的连接"><a href="#TCP的连接" class="headerlink" title="TCP的连接"></a>TCP的连接</h4><p>每一条TCP连接有两个端点，而TCP的端点叫做套接字（由端口号拼接到IP地址形成的），套接字的表示方法是在点分十进制的IP地址后面写上端口号，中间用冒号或都好隔开。</p>
<blockquote>
<p>套接字Socket = (IP地址: 端口号)</p>
</blockquote>
<p>每一条TCP连接唯一的被通信两端的两个套接字所确定：</p>
<blockquote>
<p>TCP连接::={socket1, socket2} = {(IP1:port1), (IP2:port2)}</p>
</blockquote>
<h4 id="TCP报文的首部格式"><a href="#TCP报文的首部格式" class="headerlink" title="TCP报文的首部格式"></a>TCP报文的首部格式</h4><p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fyatzvnqv6j30gs0brmzu.jpg" width="500px/"></p>
<p>TCP虽然是面向字节流的，但TCP传送的数据单元却是报文段。一个TCP报文段分为首部和数据两部分，而TCP的全部功能都体现在它首部中各字段的作用。因此，只有弄清TCP首部各字段的作用才能掌握TCP的工作原理。TCP报文首部固定部分各字段的意义如下：</p>
<ol>
<li><strong>源端口和目的端口</strong><br> 各占两字节，分别写入源端口号和目的端口号。TCP的分用也是通过端口实现的。</li>
<li><strong>报文段序号</strong><br> 占4字节。在一个TCP连接中传送的字节流中的每一个字节都按顺序编号。整个要传送的字节流的起始序号必须在连接建立时设置，首部中的序号字段值则是指本报文所发送的数据的第一个字节的序号。</li>
<li><strong>确认号</strong><br> 期望收到对方下一个报文段的第一个数据字节的序号。若确认号为N，则表明到序号N-1为止的所有数据都已正确收到。</li>
<li><strong>数据偏移</strong><br> 指出TCP报文段的数据起始处距离TCP报文段的起始处有多远，实际上指出了TCP报文段的首部长度。</li>
<li><strong>保留</strong><br> 保留为今后使用，目前应置为0.</li>
<li><strong>6个控制位</strong><br> 紧急URG：当URG为1时，表明紧急指针字段有效，告诉系统有紧急数据，应尽快优先传送。<br> 确认ACK：TCP规定，在连接建立后所有传送的报文段都必须把ACK置1。<br> 推送PSH，很少使用。<br> 复位RST：当RST=1时，表明TCP连接中出现严重错误，必须释放连接，然后再重新建立运输连接。<br> 同步SYN：在连接建立时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文段。对方若同意建立连接，则应在响应的报文段中使用SYN=1和ACK=1.<br> 终止FIN：用来释放一个连接。当FIN=1时，表明此报文段的发送方的数据已发送完毕，并要求释放运输连接。</li>
<li><strong>窗口</strong><br> 窗口字段明确指出了现在允许对方发送的数据量，该值经常在动态变化着。例如，设确认号是701，窗口字段是1000。这就表明从701算起，发送此报文段的一方还有接收1000个字节数据的接收缓存空间。</li>
<li><strong>检验和</strong><br> 检验和字段检验的范围包括首部和数据这两部分。和UDP一样，在计算检验和时要在TCP报文段的前面加上12字节的伪首部。</li>
<li><strong>紧急指针</strong><br> 紧急指针仅在URG=1时才有意义，它指出本报文段中的紧急数据的字节数。**即使窗口为零时也可发送紧急数据。</li>
<li><strong>选项</strong><br> 可选选项有最大报文长度MSS、窗口扩大选项、时间戳选项、选择确认选项等</li>
</ol>
<h4 id="TCP连接的建立与终止"><a href="#TCP连接的建立与终止" class="headerlink" title="TCP连接的建立与终止"></a>TCP连接的建立与终止</h4><p>TCP连接的建立可以简单的称为<strong>三次握手</strong>，而连接的中止则可以叫做<strong>四次握手</strong>。</p>
<h5 id="TCP的建立"><a href="#TCP的建立" class="headerlink" title="TCP的建立"></a>TCP的建立</h5><ul>
<li>首先，客户端向服务器申请打开某一个端口(用SYN段等于1的TCP报文)；</li>
<li>然后，服务器端发回一个ACK报文通知客户端请求报文收到；</li>
<li>客户端收到确认报文以后再次发出确认报文，确认刚才服务器端发出的确认报文。</li>
</ul>
<p>至此，连接的建立完成。这就叫做三次握手。如果打算让双方都做好准备的话，一定要发送三次报文，而且只需要三次报文就可以了。如果再加上TCP的超时重传机制，那么TCP就完全可以保证一个数据包被送到目的地。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwly1fyav7vnec8j30es0a576a.jpg" width="500px/"></p>
<h5 id="TCP的终止"><a href="#TCP的终止" class="headerlink" title="TCP的终止"></a>TCP的终止</h5><p>建立一个连接需要三次握手，而终止一个连接要经过4次握手，这是由TCP的半关闭（half close）造成的。既然一个 TCP连接是全双工（即数据在两个方向上能同时传递），因此每个方向必须单独地进行关闭。这原则就是当一方完成它的数据发送任务后就能发送一个 FIN来终止这个方向连接。当一端收到一个 FIN，它必须通知应用层另一端几经终止了那个方向的数据传送。</p>
<p>客户机给服务器一个FIN为1的TCP报文，然后服务器返回给客户端一个确认ACK报文，并且发送一个FIN报文，当客户机回复ACK报文后（四次握手），连接就结束了。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fyav7viu6qj30ez0bf76z.jpg" width="500px/"></p>
</div><div class="tags"><a href="/tags/网络协议/">网络协议</a></div><div class="post-nav"><a href="/2018/12/17/Bloom-Filter算法/" class="next">Bloom-Filter算法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/生活/" style="font-size: 15px;">生活</a> <a href="/tags/日清/" style="font-size: 15px;">日清</a> <a href="/tags/刷题/" style="font-size: 15px;">刷题</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/杂七杂八/" style="font-size: 15px;">杂七杂八</a> <a href="/tags/问题/" style="font-size: 15px;">问题</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/区块链/" style="font-size: 15px;">区块链</a> <a href="/tags/培训/" style="font-size: 15px;">培训</a> <a href="/tags/随想/" style="font-size: 15px;">随想</a> <a href="/tags/篮球/" style="font-size: 15px;">篮球</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/18/网络层次与TCP-UDP协议/">网络层次与TCP/UDP协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/17/Bloom-Filter算法/">Bloom-Filter算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/15/LeetCode121-123买股票的最佳时机/">LeetCode121-123买股票的最佳时机</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/15/Mobx简要学习/">Mobx简要学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/14/LeetCode118杨辉三角/">LeetCode118杨辉三角</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/13/LeetCode115不同的子序列/">LeetCode115不同的子序列</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/13/LeetCode97交叉字符串/">LeetCode97交叉字符串</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/12/LeetCode85最大矩形/">LeetCode85最大矩形</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/java集合/">java集合</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/java7-8中HashMap和CocurrentHashMap解析/">java7/8中HashMap和CocurrentHashMap解析</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.zangcq.com/" title="Chuanqiz's blog" target="_blank">Chuanqiz's blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">雷音不响，春帷不揭.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>